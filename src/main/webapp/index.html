<!DOCTYPE html>
<html>
<head>
<meta content="text/html; charset=UTF-8" http-equiv="content-type"></meta>
<title>Brain</title>

</head>

<body class="lift:content_id=main">
    <div id="main" class="lift:surround?with=default;at=content">
    <div class="lift:App.onLoad"></div>
    
        <!-- jit -->
        <div id="container" >
            <div id="center-container">
                <div id="infovis" ></div>
            </div>
            <div id="right-container">
                <h4>Tree Orientation</h4>
                <table>
                    <tr><td><label for="r-left">Left </label></td><td><input type="radio" id="r-left" name="orientation" value="left" /></td></tr>
                    <tr><td><label for="r-top">Top </label></td><td><input type="radio" id="r-top" checked="checked" name="orientation" value="top" /></td></tr>
                    <tr><td><label for="r-bottom">Bottom </label></td><td><input type="radio" id="r-bottom" name="orientation" value="bottom" /></td></tr>
                    <tr><td><label for="r-right">Right </label></td><td><input type="radio" id="r-right" name="orientation" value="right" /></td></tr>
                </table>
            </div>
            <div id="log"></div>
        </div>
        <!-- /jit -->

        <!-- Modal -->
        <form class="lift:form.ajax">
            <div data-lift="addKnowledgeForm">
                <div class="modal fade" style="display: none;" id="addKnowledgeModal" tabindex="-1" role="dialog" aria-labelledby="addKnowledgeModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h4 class="modal-title" id="addKnowledgeModalLabel">Add Knowledge</h4>
                            </div>
                            <div class="modal-body">
                                <div class="form-group">
                                    <label for="addKnowledgeNameInput">Name</label>
                                    <input type="text" class="form-control" id="addKnowledgeNameInput" placeholder="Enter new Knowledge name">
                                    <input type="hidden" name="parentId">
                                </div>
                                <span id="addKnowledgeModalStatus" style="color: red"></span>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary">Save changes</button>
                            </div>
                        </div><!-- /.modal-content -->
                    </div><!-- /.modal-dialog -->
                </div><!-- /.modal -->
            </div><!-- /.snippet -->
        </form>
        
        <!-- Modal -->
        <form class="lift:form.ajax">
            <div data-lift="renameKnowledgeForm">
                <div class="modal fade" style="display: none;" id="renameKnowledgeModal" tabindex="-1" role="dialog" aria-labelledby="renameKnowledgeModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h4 class="modal-title" id="renameKnowledgeModalLabel">Rename Knowledge</h4>
                            </div>
                            <div class="modal-body">
                                <div class="form-group">
                                    <label for="renameKnowledgeNameInput">Name</label>
                                    <input type="text" class="form-control" id="renameKnowledgeNameInput" placeholder="Enter new Knowledge name">
                                    <input type="hidden" name="id">
                                </div>
                                <span id="renameKnowledgeModalStatus" style="color: red"></span>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                <button type="submit" class="btn btn-primary">Save changes</button>
                            </div>
                        </div><!-- /.modal-content -->
                    </div><!-- /.modal-dialog -->
                </div><!-- /.modal -->
            </div><!-- /.snippet -->
        </form>
        
        <!-- Modal -->
        <form class="lift:form.ajax">
            <div data-lift="deleteKnowledgeForm">
                <div class="modal fade" style="display: none;" id="deleteKnowledgeModal" tabindex="-1" role="dialog" aria-labelledby="deleteKnowledgeModalLabel" aria-hidden="true">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h4 class="modal-title" id="deleteKnowledgeModalLabel">Delete Knowledge</h4>
                            </div>
                            <div class="modal-body">
                                <div class="form-group">
                                  Confirm to delete this knowledge?
                                    <input type="hidden" name="id">
                                </div>
                                <span id="deleteKnowledgeModalStatus" style="color: red"></span>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-primary" data-dismiss="modal" id="cancelDelete">Close</button>
                                <button type="submit" class="btn btn-default">Delete</button>
                            </div>
                        </div><!-- /.modal-content -->
                    </div><!-- /.modal-dialog -->
                </div><!-- /.modal -->
            </div><!-- /.snippet -->
        </form>

        <!-- Modal -->
        <div class="modal fade" style="display: none;" id="topicModal" tabindex="-1" role="dialog" aria-labelledby="topicModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                        <h4 class="modal-title" id="topicModalLabel">Topics of knowledge X</h4>
                    </div>
                    <div class="modal-body">
                    Topics 
                    <span id="topicModalStatus" style="color: red"></span>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
                <!-- /.modal-content -->
            </div>
            <!-- /.modal-dialog -->
        </div>
        <!-- /.modal -->


        <div id="knowledgeContextMenu" class="dropdown">
            <ul class="dropdown-menu  pull-left" role="menu" aria-labelledby="dropdownMenu" style="display:block;position:static;margin-bottom:5px;">
              <li><a tabindex="-1" data-toggle="modal" href="#addKnowledgeModal">Add Knowledge</a></li>
              <li><a tabindex="-1" data-toggle="modal" href="#renameKnowledgeModal">Rename</a></li>
              <li><a tabindex="-1" data-toggle="modal" href="#deleteKnowledgeModal">Delete</a></li>
              <li class="divider"></li>
              <li><a tabindex="-1" data-toggle="modal" href="#topicModal">Topics</a></li>
            </ul>
        </div>

    <script type="text/javascript">
    
        document.onclick       = function(e) { $knowledgeContextMenu.hide(); };
        document.oncontextmenu = function(e) { return false; };
        var $knowledgeContextMenu = $("#knowledgeContextMenu");
        
        preparaModal( "#addKnowledgeModal", "#addKnowledgeNameInput", function(){$("#addKnowledgeModal").find("#into").val(ObjectManager.lastClicked.id)});
        preparaModal( "#renameKnowledgeModal", "#renameKnowledgeNameInput", function(){
                                                          $("#renameKnowledgeNameInput").val(ObjectManager.lastClicked.name);
                                                          $("#whatToRename").val(ObjectManager.lastClicked.id);
                                                         });
        preparaModal( "#deleteKnowledgeModal", "#cancelDelete", function(){
        	$("#whatKnowledgeToDelete").val(ObjectManager.lastClicked.id);
        });
        //preparaModal( "#moveKnowledgeModal", true, function(){});
        //preparaModal( "#copyKnowledgeModal", true, function(){});
        preparaModal( "#topicModal", false, function(){});
  
        function preparaModal(modalId, elementIdToFocus, func){
        	var modal = $(modalId) 
        	modal.
            on('shown.bs.modal', function() { func(); if(elementIdToFocus)$('elementIdToFocus').focus();} ).
            on('hide.bs.modal',  function() { resetModal(modalId);} )
        }
					  
				function resetModal(modalId) {
					input = $(modalId).find('input')
					if(input.length>0)input[0].form.reset();
					$(modalId + "Status").html('');
				}
				
				function afterRenameNewKnowledge(knowledge){
					$('#renameKnowledgeModal').modal('hide');

					lastClikedNode = ObjectManager.lastClicked;
					Log.info("Knowledege '"+lastClikedNode.name+"' renamed to '" + knowledge.name + "' succefully.");
					
					lastClikedNode.name = knowledge.name
					document.getElementById(knowledge.id).innerHTML=knowledge.name
				}

				function afterAddNewKnowledge(newKnowledge) {
					$('#addKnowledgeModal').modal('hide');

					Log.info("Knowledege named '" + newKnowledge.name + "' added succefully.");
					lastClikedNode = ObjectManager.lastClicked;
					st.addSubtree(
							{
								  id : lastClikedNode.id,
								  children : [ newKnowledge ]
							}, 
							'animate', 
							{
								  hideLabels : false,
								  duration : 800,
								  onComplete : function() {
									  if (st.clickedNode.id != lastClikedNode.id) {
										  st.onClick(lastClikedNode.id);
										}
									  Log.info('Done');
									}
							}
					  )
					}

					function afterDeleteKnowledge(knowledge) {
						$('#deleteKnowledgeModal').modal('hide');
						
						var lastClickedNode = ObjectManager.lastClicked;
						var nodeParent = null;

						if (lastClickedNode) {
							if (lastClickedNode.getParents().length == 0) {
								Log.info("Is not possible to delete the tree's root knowledge.");
								return false;
							}
							nodeParent = lastClickedNode.getParents()[0];
							ObjectManager.setLastClicked(nodeParent);
							st.onClick(nodeParent.id);
						}

						st.removeSubtree(
							lastClickedNode.id,
							true,
							'animate',
							{
								duration : 500,
								hideLabels : false,
								onComplete : function() {
									Log.info("Knowledge '"+knowledge.name+"' deleted succefully.");
								}
							})
					}
				</script>

    </div>
    <!-- /main -->
</body>
</html>
